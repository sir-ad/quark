---
description: v1.3.2 Hotfix — Fix silent clipboard write failure caused by shell angle-bracket crash
---

# v1.3.2 Hotfix Plan

## Root Cause (Proven by `quark_probe.cjs`)

`writeHtml()` in `cli/src/clipboard.js` passes HTML via inline shell arg:
```
execSync(`osascript -l JavaScript -e '...<table>...'`)
```
The shell sees `<` as I/O redirection → crashes before osascript runs → `catch(e){}` swallows error silently → clipboard never updated.

## Fix: ONE file change

**File**: `cli/src/clipboard.js`  
**Target**: The macOS branch inside `writeHtml()` function (the `if (platform === 'darwin')` block).

**Replace that entire darwin block with:**

```javascript
    if (platform === 'darwin') {
      const jxaScript = `
ObjC.import("AppKit");
var pb = $.NSPasteboard.generalPasteboard;
pb.clearContents;
var htmlStr = $.NSString.alloc.initWithUTF8String($.NSProcessInfo.processInfo.environment.objectForKey("QUARK_HTML"));
var textStr = $.NSString.alloc.initWithUTF8String($.NSProcessInfo.processInfo.environment.objectForKey("QUARK_TEXT"));
pb.setStringForType(htmlStr, $("public.html"));
pb.setStringForType(textStr, $("public.utf8-plain-text"));
"ok";
      `;
      execSync('osascript -l JavaScript -', {
        input: jxaScript,
        env: { ...process.env, QUARK_HTML: html, QUARK_TEXT: plainText },
        stdio: ['pipe', 'ignore', 'ignore']
      });
    }
```

**Why**: JXA script goes via stdin (no shell parsing). HTML/text go via env vars (no escaping needed).

## Verification

Run `node quark_probe.cjs` — Stage 4 must show `write OK: true`.

## Release

1. `package.json` version: `1.3.1` → `1.3.2`
2. `git add . && git commit -m "fix: use stdin pipe for JXA to avoid shell crash (v1.3.2)" && git tag v1.3.2 && git push origin main && git push origin v1.3.2`
